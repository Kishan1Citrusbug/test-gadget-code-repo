{"version":3,"sources":["/app/packages/framework/src/auth.ts"],"sourcesContent":["import crypto from \"node:crypto\";\n\nexport const generateVerificationUrl = (customUrl?: string) => {\n  // TODO remove and replace url default with GADGET_APP_URL once it exists in gadget-server\n  if (!customUrl) throw new Error(\"Missing customUrl\");\n\n  const code = generateVerificationCode();\n  const url = new URL(customUrl);\n\n  url.searchParams.append(\"code\", code);\n\n  return {\n    url: url.toString(),\n    code,\n  };\n};\n\nexport const generateVerificationCode = (): string => {\n  return crypto.randomBytes(64).toString(\"hex\");\n};\n\nexport const generatePasswordResetCode = (): string => {\n  return crypto.randomBytes(16).toString(\"hex\");\n};\n\nexport const generatePasswordResetUrl = (customUrl?: string) => {\n  // TODO remove and replace url default with GADGET_APP_URL once it exists in gadget-server\n  if (!customUrl) throw new Error(\"Missing customUrl\");\n\n  const code = generatePasswordResetCode();\n  const url = new URL(customUrl);\n\n  url.searchParams.append(\"code\", code);\n\n  return {\n    url: url.toString(),\n    hash: crypto.createHash(\"sha256\").update(code).digest(\"hex\"),\n  };\n};\n\nexport const verifyPasswordResetCode = (code: string, hash: string) => {\n  return crypto.createHash(\"sha256\").update(code).digest(\"hex\") === hash;\n};\n"],"names":["generateVerificationUrl","generateVerificationCode","generatePasswordResetCode","generatePasswordResetUrl","verifyPasswordResetCode","customUrl","Error","code","url","URL","searchParams","append","toString","crypto","randomBytes","hash","createHash","update","digest"],"mappings":";;;;;;;;;;;IAEaA,uBAAuB;eAAvBA;;IAeAC,wBAAwB;eAAxBA;;IAIAC,yBAAyB;eAAzBA;;IAIAC,wBAAwB;eAAxBA;;IAeAC,uBAAuB;eAAvBA;;;;;;;;;;;oEAxCM;;;;;;AAEZ,MAAMJ,0BAA0B,CAACK;IACtC,0FAA0F;IAC1F,IAAI,CAACA,WAAW,MAAM,IAAIC,MAAM;IAEhC,MAAMC,OAAON;IACb,MAAMO,MAAM,IAAIC,IAAIJ;IAEpBG,IAAIE,YAAY,CAACC,MAAM,CAAC,QAAQJ;IAEhC,OAAO;QACLC,KAAKA,IAAII,QAAQ;QACjBL;IACF;AACF;AAEO,MAAMN,2BAA2B;IACtC,OAAOY,qBAAM,CAACC,WAAW,CAAC,IAAIF,QAAQ,CAAC;AACzC;AAEO,MAAMV,4BAA4B;IACvC,OAAOW,qBAAM,CAACC,WAAW,CAAC,IAAIF,QAAQ,CAAC;AACzC;AAEO,MAAMT,2BAA2B,CAACE;IACvC,0FAA0F;IAC1F,IAAI,CAACA,WAAW,MAAM,IAAIC,MAAM;IAEhC,MAAMC,OAAOL;IACb,MAAMM,MAAM,IAAIC,IAAIJ;IAEpBG,IAAIE,YAAY,CAACC,MAAM,CAAC,QAAQJ;IAEhC,OAAO;QACLC,KAAKA,IAAII,QAAQ;QACjBG,MAAMF,qBAAM,CAACG,UAAU,CAAC,UAAUC,MAAM,CAACV,MAAMW,MAAM,CAAC;IACxD;AACF;AAEO,MAAMd,0BAA0B,CAACG,MAAcQ;IACpD,OAAOF,qBAAM,CAACG,UAAU,CAAC,UAAUC,MAAM,CAACV,MAAMW,MAAM,CAAC,WAAWH;AACpE"}